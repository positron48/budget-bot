# Telegram Bot –¥–ª—è —É—á–µ—Ç–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –¥–æ—Ö–æ–¥–æ–≤ - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

## üìã –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

Telegram –±–æ—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ —Å–∏—Å—Ç–µ–º—É —É—á–µ—Ç–∞ –ª–∏—á–Ω—ã—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤. –ë–æ—Ç –≤—ã—Å—Ç—É–ø–∞–µ—Ç –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è gRPC —Å–µ—Ä–≤–∏—Å–∞ –±—é–¥–∂–µ—Ç–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —á–µ—Ä–µ–∑ Telegram.

### üéØ –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞

- **–ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** —á–µ—Ä–µ–∑ Telegram –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π** —á–µ—Ä–µ–∑ gRPC API
- **–£–º–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø–∏—Å–∞–Ω–∏—è
- **–ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å** —Å –ø—Ä–∏–≤—è–∑–∫–æ–π Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–∏—Å—Ç–µ–º—ã
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å—Ö–µ–º–∞

```mermaid
flowchart TB
    subgraph "Telegram Bot"
        TG[Telegram Bot Service]
        Parser[Message Parser]
        CategoryMatcher[Category Matcher]
        StateManager[State Manager]
        AuthManager[Auth Manager]
    end
    
    subgraph "Budget Service"
        GRPC[gRPC API]
        Auth[Auth Service]
        Transaction[Transaction Service]
        Category[Category Service]
        User[User Service]
    end
    
    subgraph "Storage"
        BotDB[(Bot Database)]
        MainDB[(Main Database)]
    end
    
    TG -->|parse| Parser
    TG -->|match categories| CategoryMatcher
    TG -->|manage state| StateManager
    TG -->|authenticate| AuthManager
    
    AuthManager -->|gRPC| Auth
    Parser -->|create transaction| Transaction
    CategoryMatcher -->|get categories| Category
    StateManager -->|store state| BotDB
    AuthManager -->|store tokens| BotDB
    
    Auth -->|JWT tokens| AuthManager
    Transaction -->|store data| MainDB
    Category -->|get data| MainDB
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

1. **Telegram Bot Service** - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –±–æ—Ç–∞
2. **Message Parser** - –ø–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **Category Matcher** - —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏–π —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
4. **State Manager** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –¥–∏–∞–ª–æ–≥–∞
5. **Auth Manager** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
6. **gRPC Client** - –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend
- **–Ø–∑—ã–∫**: Go 1.23+
- **Telegram Bot API**: `github.com/go-telegram-bot-api/telegram-bot-api/v5`
- **gRPC Client**: `google.golang.org/grpc`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: SQLite (–¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞)
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: Viper + .env (godotenv)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: Zap
- **–ú–∏–≥—Ä–∞—Ü–∏–∏**: golang-migrate

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
telegram-bot/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ bot/
‚îÇ       ‚îî‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parser.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ category_matcher.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ state_manager.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth_manager.go
‚îÇ   ‚îú‚îÄ‚îÄ grpc/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_client.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transaction_client.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ category_client.go
‚îÇ   ‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_session.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transaction_draft.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ category_mapping.go
‚îÇ   ‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session_repo.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ category_mapping_repo.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user_repo.go
‚îÇ   ‚îî‚îÄ‚îÄ pkg/
‚îÇ       ‚îú‚îÄ‚îÄ config/
‚îÇ       ‚îú‚îÄ‚îÄ logger/
‚îÇ       ‚îî‚îÄ‚îÄ utils/
‚îú‚îÄ‚îÄ migrations/
‚îú‚îÄ‚îÄ configs/
‚îú‚îÄ‚îÄ docker/
‚îî‚îÄ‚îÄ docs/
```

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

### –°—Ö–µ–º–∞ –ø—Ä–∏–≤—è–∑–∫–∏ Telegram –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞**:
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`
   - –ë–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏–ª–∏ –≤–æ–π—Ç–∏
   - –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç email –∏ –ø–∞—Ä–æ–ª—å
   - –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —á–µ—Ä–µ–∑ gRPC
   - –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç Telegram ID –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

2. **–í—Ö–æ–¥ —á–µ—Ä–µ–∑ –±–æ—Ç–∞**:
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/login`
   - –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç email –∏ –ø–∞—Ä–æ–ª—å
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ gRPC Auth Service
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç Telegram ID –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

3. **–•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π**:
   ```sql
   CREATE TABLE user_sessions (
       telegram_id BIGINT PRIMARY KEY,
       user_id UUID NOT NULL,
       tenant_id UUID NOT NULL,
       access_token TEXT NOT NULL,
       refresh_token TEXT NOT NULL,
       access_token_expires_at TIMESTAMP NOT NULL,
       refresh_token_expires_at TIMESTAMP NOT NULL,
       created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
       updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
   );
   ```

### –ö–æ–º–∞–Ω–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

- `/start` - –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º
- `/login` - –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- `/register` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/logout` - –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- `/switch_tenant` - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏
- `/language` - –≤—ã–±–æ—Ä —è–∑—ã–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- `/currency` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∞–ª—é—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

## üí¨ –ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π

### –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π

–ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:

```
[–¥–∞—Ç–∞] [+]—Å—É–º–º–∞[–≤–∞–ª—é—Ç–∞] –æ–ø–∏—Å–∞–Ω–∏–µ
```

–ì–¥–µ:
- `[–¥–∞—Ç–∞]` - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ:
  - –ü—Ä–æ–ø—É—â–µ–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞)
  - "—Å–µ–≥–æ–¥–Ω—è", "–≤—á–µ—Ä–∞", "–ø–æ–∑–∞–≤—á–µ—Ä–∞"
  - –í —Ñ–æ—Ä–º–∞—Ç–µ "DD.MM.YYYY" –∏–ª–∏ "DD.MM"
- `[+]` - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∑–Ω–∞–∫ –¥–ª—è –¥–æ—Ö–æ–¥–æ–≤ (–±–µ–∑ –∑–Ω–∞–∫–∞ = —Ä–∞—Å—Ö–æ–¥)
- `—Å—É–º–º–∞` - —á–∏—Å–ª–æ —Å —Ç–æ—á–∫–æ–π –∏–ª–∏ –∑–∞–ø—è—Ç–æ–π –¥–ª—è –∫–æ–ø–µ–µ–∫
- `[–≤–∞–ª—é—Ç–∞]` - –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ:
  - –ü—Ä–æ–ø—É—â–µ–Ω–æ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–∞–ª—é—Ç–∞ —Ç–µ–Ω–∞–Ω—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  - –°–∏–º–≤–æ–ª –≤–∞–ª—é—Ç—ã: ‚ÇΩ, $, ‚Ç¨, ¬£, ¬•
  - –ö–æ–¥ –≤–∞–ª—é—Ç—ã: RUB, USD, EUR, GBP, JPY
- `–æ–ø–∏—Å–∞–Ω–∏–µ` - —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π

```
1000 –ø—Ä–æ–¥—É–∫—Ç—ã
+50000 –∑–∞—Ä–ø–ª–∞—Ç–∞
01.12 5000 –ø–æ–¥–∞—Ä–æ–∫
12.12.2023 1234.56 —Ç–∞–∫—Å–∏
–≤—á–µ—Ä–∞ 100 –∫–æ—Ñ–µ
—Å–µ–≥–æ–¥–Ω—è +1000 –≤–æ–∑–≤—Ä–∞—Ç

# –° —É–∫–∞–∑–∞–Ω–∏–µ–º –≤–∞–ª—é—Ç—ã
1000‚ÇΩ –ø—Ä–æ–¥—É–∫—Ç—ã
+50000$ –∑–∞—Ä–ø–ª–∞—Ç–∞
01.12 5000 EUR –ø–æ–¥–∞—Ä–æ–∫
12.12.2023 1234.56 USD —Ç–∞–∫—Å–∏
–≤—á–µ—Ä–∞ 100 RUB –∫–æ—Ñ–µ
—Å–µ–≥–æ–¥–Ω—è +1000 GBP –≤–æ–∑–≤—Ä–∞—Ç
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø–∞—Ä—Å–∏–Ω–≥–∞

1. **–†–∞–∑–±–æ—Ä –¥–∞—Ç—ã**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ ("—Å–µ–≥–æ–¥–Ω—è", "–≤—á–µ—Ä–∞", "–ø–æ–∑–∞–≤—á–µ—Ä–∞")
   - –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–æ—Ä–º–∞—Ç–æ–≤ "DD.MM.YYYY" –∏ "DD.MM"
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞—Ç—ã

2. **–†–∞–∑–±–æ—Ä —Å—É–º–º—ã**:
   - –ü–æ–∏—Å–∫ —á–∏—Å–ª–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ–π —Ç–æ—á–∫–æ–π/–∑–∞–ø—è—Ç–æ–π
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ –∑–Ω–∞–∫—É "+"
   - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ minor units (–∫–æ–ø–µ–π–∫–∏)

3. **–†–∞–∑–±–æ—Ä –≤–∞–ª—é—Ç—ã**:
   - –ü–æ–∏—Å–∫ —Å–∏–º–≤–æ–ª–æ–≤ –≤–∞–ª—é—Ç (‚ÇΩ, $, ‚Ç¨, ¬£, ¬•)
   - –ü–æ–∏—Å–∫ –∫–æ–¥–æ–≤ –≤–∞–ª—é—Ç (RUB, USD, EUR, GBP, JPY)
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –≤–∞–ª—é—Ç—ã
   - –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

4. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è**:
   - –û—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å—É–º–º—ã –∏ –≤–∞–ª—é—Ç—ã
   - –û—á–∏—Å—Ç–∫–∞ –æ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤

## üè∑Ô∏è –°–∏—Å—Ç–µ–º–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

1. **–ë–∞–∑–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π**:
   ```sql
   CREATE TABLE category_mappings (
       id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
       tenant_id UUID NOT NULL,
       keyword TEXT NOT NULL,
       category_id UUID NOT NULL,
       priority INTEGER DEFAULT 0,
       created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
       UNIQUE(tenant_id, keyword)
   );
   ```

2. **–ê–ª–≥–æ—Ä–∏—Ç–º —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è**:
   - –ü–æ–∏—Å–∫ —Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
   - –ü–æ–∏—Å–∫ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π (–ø–æ–¥—Å—Ç—Ä–æ–∫–∏)
   - –£—á–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π
   - –í–æ–∑–≤—Ä–∞—Ç –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

3. **–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏**:
   - `/categories` - —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - `/map —Å–ª–æ–≤–æ = –∫–∞—Ç–µ–≥–æ—Ä–∏—è` - –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
   - `/map —Å–ª–æ–≤–æ` - –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
   - `/map --all` - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
   - `/unmap —Å–ª–æ–≤–æ` - —É–¥–∞–ª–∏—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

### –£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏

1. **–ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏–∏**:
   - –ê–Ω–∞–ª–∏–∑ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π
   - –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Ö–æ–∂–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏

2. **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏**:
   - –£—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫ –∏ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
   - –£—á–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞)
   - –£—á–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

## üîÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞

```go
type DialogState string

const (
    StateIdle DialogState = "idle"
    StateWaitingForAmount DialogState = "waiting_for_amount"
    StateWaitingForDescription DialogState = "waiting_for_description"
    StateWaitingForCategory DialogState = "waiting_for_category"
    StateWaitingForDate DialogState = "waiting_for_date"
    StateWaitingForEmail DialogState = "waiting_for_email"
    StateWaitingForPassword DialogState = "waiting_for_password"
    StateConfirmingTransaction DialogState = "confirming_transaction"
)
```

### –ß–µ—Ä–Ω–æ–≤–∏–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

```go
type TransactionDraft struct {
    ID          string
    TelegramID  int64
    Type        TransactionType
    Amount      *Money
    Description string
    CategoryID  string
    OccurredAt  *time.Time
    CreatedAt   time.Time
}
```

### –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```sql
CREATE TABLE dialog_states (
    telegram_id BIGINT PRIMARY KEY,
    state TEXT NOT NULL,
    draft_id UUID,
    context JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE user_preferences (
    telegram_id BIGINT PRIMARY KEY,
    language TEXT DEFAULT 'ru',
    default_currency TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## üìä API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### gRPC –∫–ª–∏–µ–Ω—Ç—ã

1. **Auth Client**:
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

2. **Transaction Client**:
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

3. **Category Client**:
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏

4. **User Client**:
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

1. **–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏**:
   - Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
   - Fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

2. **–û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
   - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
   - –û—á–∏—Å—Ç–∫–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–µ—Å—Å–∏–π

## üé® –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π

1. **–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**:
   - –ü—Ä–æ—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã
   - –°–ø–∏—Å–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

2. **Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã**:
   - –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
   - –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ–Ω—é

3. **Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã**:
   - –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã
   - –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—É–º–º—ã
   - –®–∞–±–ª–æ–Ω—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

```
üí∞ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:
üìÖ 15.12.2023
üí∏ –†–∞—Å—Ö–æ–¥: 1,000.00 ‚ÇΩ
üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ü–∏—Ç–∞–Ω–∏–µ
üìù –û–ø–∏—Å–∞–Ω–∏–µ: –ø—Ä–æ–¥—É–∫—Ç—ã

‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ
```

```
–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è "—Ç–∞–∫—Å–∏":

üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
üçΩÔ∏è –ü–∏—Ç–∞–Ω–∏–µ  
üè† –î–æ–º
üéØ –î—Ä—É–≥–æ–µ
```

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –ö–æ–º–∞–Ω–¥—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

- `/stats` - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
- `/stats 2023-12` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–µ—Å—è—Ü
- `/stats week` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é
- `/top_categories` - —Ç–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ —Ä–∞—Å—Ö–æ–¥–∞–º
- `/recent` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### –ú–µ—Ç—Ä–∏–∫–∏ –±–æ—Ç–∞

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏**:
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –¥–µ–Ω—å
   - –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

2. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏**:
   - –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∏ CPU

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Telegram
TELEGRAM_BOT_TOKEN=your_token_here
TELEGRAM_API_BASE_URL=http://127.0.0.1:3001/
TELEGRAM_DEBUG=true
TELEGRAM_UPDATES_TIMEOUT=30

# gRPC
GRPC_SERVER_ADDRESS=127.0.0.1:8080
GRPC_INSECURE=true

# Database
DATABASE_DRIVER=sqlite3
DATABASE_DSN=file:./data/bot.sqlite3?_foreign_keys=on

# Logging
LOG_LEVEL=debug

# Metrics
METRICS_ENABLED=false
METRICS_ADDRESS=:9090

```

–ü—Ä–∏–º–µ—Ä `.env`: —Å–º. `env.example`.
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```yaml
# configs/config.yaml
telegram:
  token: ${TELEGRAM_BOT_TOKEN}
  webhook_url: ${TELEGRAM_WEBHOOK_URL}
  timeout: 30s

grpc:
  server_address: ${GRPC_SERVER_ADDRESS}
  tls_enabled: ${GRPC_TLS_ENABLED}
  timeout: 10s
  retry_attempts: 3

database:
  url: ${DATABASE_URL}
  max_connections: 10
  connection_timeout: 5s

logging:
  level: ${LOG_LEVEL}
  format: ${LOG_FORMAT}

metrics:
  enabled: ${METRICS_ENABLED}
  port: ${METRICS_PORT}

security:
  jwt_secret: ${JWT_SECRET}
  session_timeout: 24h
```

## üöÄ –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (1-2 –Ω–µ–¥–µ–ª–∏)

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞**:
   - –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Go –º–æ–¥—É–ª–µ–π
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD

2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**:
   - [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ SQLite (`migrations/0001_init.*.sql`)
   - [x] –ò–Ω–∏—Ç –∏ –∞–≤—Ç–æ–ø—Ä–æ–≥–æ–Ω –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (`internal/pkg/db`)
   - [x] –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏: sessions, dialog_state, preferences, category_mappings

3. **gRPC –∫–ª–∏–µ–Ω—Ç—ã**:
   - [ ] –°–±–æ—Ä–∫–∞ pb –∏–∑ proto (`make proto`)
   - [ ] Auth Client (–≤—Ä–µ–º–µ–Ω–Ω—ã–π fake, –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π)
   - [ ] Transaction Client
   - [ ] Category Client

### –≠—Ç–∞–ø 2: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (1 –Ω–µ–¥–µ–ª—è)

1. **–°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**:
   - [x] –ö–æ–º–∞–Ω–¥—ã `/login`, `/register`, `/logout` (–¥–∏–∞–ª–æ–≥–∏)
   - [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ (SQLite)
   - [ ] gRPC –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Auth (–∑–∞–º–µ–Ω–∏—Ç—å fake)

2. **–ü—Ä–∏–≤—è–∑–∫–∞ Telegram –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º**:
   - –°–≤—è–∑—ã–≤–∞–Ω–∏–µ Telegram ID —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏
   - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏

### –≠—Ç–∞–ø 3: –ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π (1 –Ω–µ–¥–µ–ª—è)

1. **–ü–∞—Ä—Å–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π**:
   - [x] –ë–∞–∑–æ–≤—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç (—Å–µ–≥–æ–¥–Ω—è, –≤—á–µ—Ä–∞, –ø–æ–∑–∞–≤—á–µ—Ä–∞, DD.MM(.YYYY))
   - [x] –†–∞–∑–±–æ—Ä —Å—É–º–º –∏ —Ç–∏–ø–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (+ –¥–æ—Ö–æ–¥, –∏–Ω–∞—á–µ —Ä–∞—Å—Ö–æ–¥)
   - [x] –í–∞–ª—é—Ç–∞ (—Å–∏–º–≤–æ–ª—ã/–∫–æ–¥—ã) ‚Äî –±–∞–∑–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
   - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞—Ç
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞

### –≠—Ç–∞–ø 4: –°–∏—Å—Ç–µ–º–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ (1-2 –Ω–µ–¥–µ–ª–∏)

1. **–ë–∞–∑–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π**:
   - –¢–∞–±–ª–∏—Ü–∞ category_mappings
   - API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º–∏
   - –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

2. **–ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
   - `/categories` - —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - `/map` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º–∏ (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)
   - `/unmap` - —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)

3. **–£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏**:
   - –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏

### –≠—Ç–∞–ø 5: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (1 –Ω–µ–¥–µ–ª—è)

1. **State Manager**:
   - –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞
   - –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

2. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏**:
   - –ó–∞–ø—Ä–æ—Å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–π

### –≠—Ç–∞–ø 6: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (1 –Ω–µ–¥–µ–ª—è)

1. **–¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π**:
   - –¢–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã
   - Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
   - Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

2. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –ö—Ä–∞—Å–∏–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã
   - –°–ø–∏—Å–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

### –≠—Ç–∞–ø 7: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (1 –Ω–µ–¥–µ–ª—è)

1. **–ö–æ–º–∞–Ω–¥—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏**:
   - `/stats` - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   - `/top_categories` - —Ç–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - `/recent` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

2. **–ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
   - Prometheus –º–µ—Ç—Ä–∏–∫–∏
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ê–ª–µ—Ä—Ç—ã

### –≠—Ç–∞–ø 8: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (1 –Ω–µ–¥–µ–ª—è)

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - Unit —Ç–µ—Å—Ç—ã
   - Integration —Ç–µ—Å—Ç—ã
   - E2E —Ç–µ—Å—Ç—ã

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**:
   - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
   - –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞

3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**:
   - README
   - API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìã –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- `/start` - –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º
- `/help` - —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
- `/login` - –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- `/register` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `/logout` - –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

- `1000 –ø—Ä–æ–¥—É–∫—Ç—ã` - –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥
- `+50000 –∑–∞—Ä–ø–ª–∞—Ç–∞` - –¥–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥
- `01.12 5000 –ø–æ–¥–∞—Ä–æ–∫` - –¥–æ–±–∞–≤–∏—Ç—å —Å –¥–∞—Ç–æ–π
- `1000‚ÇΩ –ø—Ä–æ–¥—É–∫—Ç—ã` - –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥ –≤ —Ä—É–±–ª—è—Ö
- `+50000$ –∑–∞—Ä–ø–ª–∞—Ç–∞` - –¥–æ–±–∞–≤–∏—Ç—å –¥–æ—Ö–æ–¥ –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö
- `/cancel` - –æ—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é –æ–ø–µ—Ä–∞—Ü–∏—é

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏

- `/categories` - —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- `/map —Å–ª–æ–≤–æ = –∫–∞—Ç–µ–≥–æ—Ä–∏—è` - –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
- `/map —Å–ª–æ–≤–æ` - –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
- `/map --all` - –≤—Å–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
- `/unmap —Å–ª–æ–≤–æ` - —É–¥–∞–ª–∏—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- `/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –º–µ—Å—è—Ü
- `/stats 2023-12` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
- `/stats week` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é
- `/top_categories` - —Ç–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- `/recent` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏

- `/profile` - –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/switch_tenant` - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- `/language` - –≤—ã–±–æ—Ä —è–∑—ã–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- `/currency` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∞–ª—é—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- `/settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
- `/export` - —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

## üåç –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å –∏ –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —è–∑—ã–∫–æ–≤

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —è–∑—ã–∫–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

1. **–†—É—Å—Å–∫–∏–π (ru)** - –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫
2. **–ê–Ω–≥–ª–∏–π—Å–∫–∏–π (en)** - –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —è–∑—ã–∫
3. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —è–∑—ã–∫–∏** - –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

#### –í—ã–±–æ—Ä —è–∑—ã–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ

```go
func (h *Handler) handleStart(ctx context.Context, update tgbotapi.Update) error {
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤—ã–±–æ—Ä–æ–º —è–∑—ã–∫–∞
    keyboard := tgbotapi.NewInlineKeyboardMarkup(
        tgbotapi.NewInlineKeyboardRow(
            tgbotapi.NewInlineKeyboardButtonData("üá∑üá∫ –†—É—Å—Å–∫–∏–π", "lang_ru"),
            tgbotapi.NewInlineKeyboardButtonData("üá∫üá∏ English", "lang_en"),
        ),
    )
    
    msg := tgbotapi.NewMessage(update.Message.Chat.ID, 
        "–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ / Choose language:")
    msg.ReplyMarkup = keyboard
    
    return h.bot.Send(msg)
}
```

#### –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

```go
type LocalizedMessages struct {
    messages map[string]map[string]string
}

var messages = map[string]map[string]string{
    "ru": {
        "welcome": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç —É—á–µ—Ç–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤!",
        "transaction_added": "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞",
        "select_category": "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é",
        "amount": "–°—É–º–º–∞",
        "description": "–û–ø–∏—Å–∞–Ω–∏–µ",
        "date": "–î–∞—Ç–∞",
        "category": "–ö–∞—Ç–µ–≥–æ—Ä–∏—è",
        "income": "–î–æ—Ö–æ–¥",
        "expense": "–†–∞—Å—Ö–æ–¥",
    },
    "en": {
        "welcome": "Welcome to the finance tracking bot!",
        "transaction_added": "Transaction added",
        "select_category": "Select category",
        "amount": "Amount",
        "description": "Description",
        "date": "Date",
        "category": "Category",
        "income": "Income",
        "expense": "Expense",
    },
}
```

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∞–ª—é—Ç

#### –í–∞–ª—é—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

1. **–†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—É–±–ª—å (RUB)** - –æ—Å–Ω–æ–≤–Ω–∞—è –≤–∞–ª—é—Ç–∞
2. **–î–æ–ª–ª–∞—Ä –°–®–ê (USD)** - –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è –≤–∞–ª—é—Ç–∞
3. **–ï–≤—Ä–æ (EUR)** - –µ–≤—Ä–æ–ø–µ–π—Å–∫–∞—è –≤–∞–ª—é—Ç–∞
4. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–∞–ª—é—Ç—ã** - –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

#### –ü–∞—Ä—Å–∏–Ω–≥ –≤–∞–ª—é—Ç –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

```go
type CurrencyParser struct {
    symbolToCode map[string]string
    codeToSymbol map[string]string
}

func (cp *CurrencyParser) ParseCurrency(text string) (string, string, error) {
    // –ü–æ–∏—Å–∫ —Å–∏–º–≤–æ–ª–æ–≤ –≤–∞–ª—é—Ç
    currencySymbols := map[string]string{
        "‚ÇΩ": "RUB",
        "$": "USD", 
        "‚Ç¨": "EUR",
        "¬£": "GBP",
        "¬•": "JPY",
    }
    
    // –ü–æ–∏—Å–∫ –∫–æ–¥–æ–≤ –≤–∞–ª—é—Ç
    currencyCodes := []string{"RUB", "USD", "EUR", "GBP", "JPY"}
    
    // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã –∏–∑ —Ç–µ–∫—Å—Ç–∞
    for symbol, code := range currencySymbols {
        if strings.Contains(text, symbol) {
            return code, symbol, nil
        }
    }
    
    for _, code := range currencyCodes {
        if strings.Contains(strings.ToUpper(text), code) {
            return code, cp.codeToSymbol[code], nil
        }
    }
    
    return "", "", nil // –≤–∞–ª—é—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞
}
```

#### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç

```go
type CurrencyConverter struct {
    fxClient grpc.FxClient
    logger   *zap.Logger
}

func (cc *CurrencyConverter) ConvertToBaseCurrency(
    amount *Money, 
    fromCurrency string, 
    toCurrency string,
    date time.Time,
) (*Money, error) {
    if fromCurrency == toCurrency {
        return amount, nil
    }
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –≤–∞–ª—é—Ç —á–µ—Ä–µ–∑ gRPC
    rate, err := cc.fxClient.GetExchangeRate(context.Background(), &pb.GetExchangeRateRequest{
        FromCurrency: fromCurrency,
        ToCurrency:   toCurrency,
        Date:         timestamppb.New(date),
    })
    
    if err != nil {
        return nil, fmt.Errorf("failed to get exchange rate: %w", err)
    }
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å—É–º–º—ã
    convertedAmount := amount.MinorUnits * int64(rate.Rate*10000) / 10000
    
    return &Money{
        MinorUnits: convertedAmount,
        Currency:   toCurrency,
    }, nil
}
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∞–ª—é—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

```go
func (h *Handler) handleCurrency(ctx context.Context, update tgbotapi.Update) error {
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–∞–ª—é—Ç
    keyboard := tgbotapi.NewInlineKeyboardMarkup(
        tgbotapi.NewInlineKeyboardRow(
            tgbotapi.NewInlineKeyboardButtonData("‚ÇΩ RUB", "currency_RUB"),
            tgbotapi.NewInlineKeyboardButtonData("$ USD", "currency_USD"),
        ),
        tgbotapi.NewInlineKeyboardRow(
            tgbotapi.NewInlineKeyboardButtonData("‚Ç¨ EUR", "currency_EUR"),
            tgbotapi.NewInlineKeyboardButtonData("¬£ GBP", "currency_GBP"),
        ),
    )
    
    msg := tgbotapi.NewMessage(update.Message.Chat.ID, 
        "–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:")
    msg.ReplyMarkup = keyboard
    
    return h.bot.Send(msg)
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∞–ª—é—Ç—ã —Ç–µ–Ω–∞–Ω—Ç–∞

```go
func (h *Handler) getTenantDefaultCurrency(ctx context.Context, tenantID string) (string, error) {
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–Ω–∞–Ω—Ç–µ —á–µ—Ä–µ–∑ gRPC
    tenant, err := h.tenantClient.GetTenant(ctx, &pb.GetTenantRequest{
        Id: tenantID,
    })
    
    if err != nil {
        return "RUB", err // –≤–∞–ª—é—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    }
    
    return tenant.DefaultCurrency, nil
}
```

#### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É–º–º

```go
type MoneyFormatter struct {
    locale string
}

func (mf *MoneyFormatter) FormatMoney(amount *Money, locale string) string {
    switch locale {
    case "ru":
        return fmt.Sprintf("%.2f %s", float64(amount.MinorUnits)/100, amount.Currency)
    case "en":
        return fmt.Sprintf("%s %.2f", amount.Currency, float64(amount.MinorUnits)/100)
    default:
        return fmt.Sprintf("%.2f %s", float64(amount.MinorUnits)/100, amount.Currency)
    }
}
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –°–æ–æ–±—â–µ–Ω–∏—è —Å –≤–∞–ª—é—Ç–æ–π

```
# –ë–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –≤–∞–ª—é—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–∞–ª—é—Ç–∞ —Ç–µ–Ω–∞–Ω—Ç–∞)
1000 –ø—Ä–æ–¥—É–∫—Ç—ã

# –° —Å–∏–º–≤–æ–ª–æ–º –≤–∞–ª—é—Ç—ã
1000‚ÇΩ –ø—Ä–æ–¥—É–∫—Ç—ã
+50000$ –∑–∞—Ä–ø–ª–∞—Ç–∞
200‚Ç¨ –ø–æ–¥–∞—Ä–æ–∫

# –° –∫–æ–¥–æ–º –≤–∞–ª—é—Ç—ã
1000 RUB –ø—Ä–æ–¥—É–∫—Ç—ã
+50000 USD –∑–∞—Ä–ø–ª–∞—Ç–∞
200 EUR –ø–æ–¥–∞—Ä–æ–∫

# –° –¥–∞—Ç–æ–π –∏ –≤–∞–ª—é—Ç–æ–π
01.12 5000‚ÇΩ –ø–æ–¥–∞—Ä–æ–∫
–≤—á–µ—Ä–∞ 100$ –∫–æ—Ñ–µ
—Å–µ–≥–æ–¥–Ω—è +1000 EUR –≤–æ–∑–≤—Ä–∞—Ç
```

#### –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

```
üá∑üá∫ –†—É—Å—Å–∫–∏–π:
üí∞ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:
üìÖ 15.12.2023
üí∏ –†–∞—Å—Ö–æ–¥: 1,000.00 ‚ÇΩ
üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –ü–∏—Ç–∞–Ω–∏–µ
üìù –û–ø–∏—Å–∞–Ω–∏–µ: –ø—Ä–æ–¥—É–∫—Ç—ã

üá∫üá∏ English:
üí∞ Transaction added:
üìÖ 15.12.2023
üí∏ Expense: $1,000.00
üè∑Ô∏è Category: Food
üìù Description: groceries
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

1. **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**:
   - JWT —Ç–æ–∫–µ–Ω—ã –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ
   - HTTPS –¥–ª—è –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

2. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram ID
   - –í–∞–ª–∏–¥–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

3. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º
   - –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

1. **–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏**:
   - Retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
   - Circuit breaker –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–±–æ–µ–≤
   - Graceful degradation

2. **–û—à–∏–±–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
   - –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
   - –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ú–µ—Ç—Ä–∏–∫–∏ Prometheus

```go
var (
    transactionsTotal = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: "bot_transactions_total",
            Help: "Total number of transactions created",
        },
        []string{"type", "status"},
    )
    
    responseTime = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name: "bot_response_time_seconds",
            Help: "Bot response time in seconds",
        },
        []string{"command"},
    )
    
    activeUsers = prometheus.NewGauge(
        prometheus.GaugeOpts{
            Name: "bot_active_users",
            Help: "Number of active users",
        },
    )
)
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```go
logger.Info("transaction_created",
    zap.String("telegram_id", telegramID),
    zap.String("user_id", userID),
    zap.String("transaction_id", transactionID),
    zap.String("type", transactionType),
    zap.Float64("amount", amount),
    zap.String("category", category),
)
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Docker

```dockerfile
FROM golang:1.23-alpine AS builder
WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download
COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o bot ./cmd/bot

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /app/bot .
COPY --from=builder /app/configs ./configs
CMD ["./bot"]
```

### Docker Compose

```yaml
version: '3.8'
services:
  telegram-bot:
    build: .
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - GRPC_SERVER_ADDRESS=budget-service:8080
      - DATABASE_URL=sqlite:///data/bot.db
    volumes:
      - ./data:/root/data
    ports:
      - "9090:9090"  # metrics
    depends_on:
      - budget-service
```

### Kubernetes

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: telegram-bot
spec:
  replicas: 2
  selector:
    matchLabels:
      app: telegram-bot
  template:
    metadata:
      labels:
        app: telegram-bot
    spec:
      containers:
      - name: bot
        image: telegram-bot:latest
        env:
        - name: TELEGRAM_BOT_TOKEN
          valueFrom:
            secretKeyRef:
              name: telegram-secrets
              key: bot-token
        ports:
        - containerPort: 9090
          name: metrics
```

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **Stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
   - –í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
   - Load balancing —á–µ—Ä–µ–∑ nginx

2. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
   - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ—Å—Å–∏–π
   - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
   - –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**:
   - –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
   - –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∞—Ç–∞–º
   - Connection pooling

2. **gRPC**:
   - Keep-alive —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   - Connection pooling
   - Retry —Å backoff

3. **Telegram API**:
   - Webhook –≤–º–µ—Å—Ç–æ polling
   - Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
   - Rate limiting

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**:
   - –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏
   - –ì–æ–ª–æ—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –ì–æ–ª–æ—Å–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã

2. **–§–æ—Ç–æ —á–µ–∫–æ–≤**:
   - OCR –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ —á–µ–∫–æ–≤

3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**:
   - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–∞—Ö
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –±—é–¥–∂–µ—Ç–∞
   - –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**:
   - –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ API
   - –ö–∞—Å—Å–æ–≤—ã–µ –∞–ø–ø–∞—Ä–∞—Ç—ã
   - –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ**:
   - –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤
   - –ê–Ω–æ–º–∞–ª—å–Ω–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ

2. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**:
   - –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤
   - –¢—Ä–µ–Ω–¥—ã –∏ –ø—Ä–æ–≥–Ω–æ–∑—ã
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–≤

3. **–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö**:
   - –≠–∫—Å–ø–æ—Ä—Ç –≤ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

---

**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞**: üìã –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–î–∞–Ω–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram –±–æ—Ç–∞ —É—á–µ—Ç–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –¥–æ—Ö–æ–¥–æ–≤. –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–µ—Ç–∞–ª—å–Ω–æ –æ–ø–∏—Å–∞–Ω—ã —Å —É—á–µ—Ç–æ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π gRPC —Å–∏—Å—Ç–µ–º–æ–π.
