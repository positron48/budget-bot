# AGENTS.md — Budget Bot

Краткая справка для быстрого погружения в проект.

## Что это
Telegram‑бот для быстрого добавления транзакций в систему учета финансов. Бот — отдельный клиент, который общается с основным сервисом бюджета по gRPC, хранит сессии/состояния в SQLite и поддерживает команды для отчетов и настроек.

## Как работает (в двух словах)
- Пользователь пишет в Telegram, бот парсит сообщение и превращает его в транзакцию.
- Авторизация и работа с данными идут через gRPC‑клиенты к основному сервису.
- Локальное состояние (сессии, настройки, маппинги категорий) хранится в SQLite.
- Поддерживаются режимы Long Polling и Webhook.

## Из чего состоит
- `cmd/bot/` — точка входа приложения.
- `internal/bot/` — основная логика бота: парсинг, обработчики команд, UI.
- `internal/grpc/` — gRPC‑клиенты для связи с основным сервисом.
- `internal/domain/` — доменные модели.
- `internal/repository/` — доступ к локальной БД (SQLite).
- `internal/pkg/` — общие пакеты (config, db, logger).
- `proto/` и `internal/pb/` — protobuf схемы и сгенерированные клиенты.
- `migrations/` — миграции SQLite.

## Быстрый старт (по README)
- `cp env.example .env` — базовая настройка.
- `make proto` — генерация gRPC клиентов.
- `make build && make run` — запуск.

## Полезные файлы
- `readme.md` — основная документация.
- `docs/readme_commands.md` — полный список команд бота.
- `configs/config.yaml` — пример конфигурации.
- `env.example` — переменные окружения.
- `docs/agent-guides/add-transaction-flow.md` — подробный флоу добавления транзакции в боте и маппинга категории.

## Контекст для быстрого входа
- Формат сообщений: `[дата] [+]сумма[валюта] описание`.
- Команды: `/start`, `/register`, `/login`, `/stats`, `/recent`, `/export`, `/categories`, `/map` и др.
- gRPC адрес: `GRPC_SERVER_ADDRESS` в `.env`.
- БД по умолчанию: SQLite (`DATABASE_DSN`).

## Правило фиксации знаний
- Любые важные договоренности, архитектурные решения, нестандартные флоу и найденные подводные камни нужно фиксировать в файловой документации (`AGENTS.md`, `docs/*`, `plans/*`) в том же PR/изменении, где они появились.
- Не оставлять критичный контекст только в переписке: если это может повлиять на будущую разработку или отладку, это должно быть записано в репозитории.
